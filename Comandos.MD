# ğŸ› ï¸ Manual Avanzado CLI - Issabel PBX / Asterisk (Navaja Suiza de Comandos)
**Autor:** JesÃºs Flores â€“ Soporte TI  
**VersiÃ³n:** 2025.04  
**PropÃ³sito:** GuÃ­a profesional de referencia para administraciÃ³n, monitoreo y soluciÃ³n de problemas en entornos Asterisk e Issabel desde CLI.

---

## ğŸ“‘ ÃNDICE

- [1. ğŸ§­ NavegaciÃ³n y ayuda CLI](#1--navegaciÃ³n-y-ayuda-cli)
- [2. ğŸ“ Extensiones PJSIP y SIP](#2--extensiones-pjsip-y-sip)
    - [ğŸ”¹ PJSIP](#-pjsip)
    - [ğŸ”¹ SIP clÃ¡sico (chan\_sip)](#-sip-clÃ¡sico-chan_sip)
    - [ğŸ”¹ IAX2](#-iax2)
- [3. ğŸ“¡ Troncales y registros externos](#3--troncales-y-registros-externos)
- [4. ğŸ“Š Canales y llamadas](#4--canales-y-llamadas)
- [5. ğŸ” Recargas, mÃ³dulos y reinicios](#5--recargas-mÃ³dulos-y-reinicios)
- [6. ğŸ“¥ Colas y agentes](#6--colas-y-agentes)
- [7. ğŸ™ï¸ Conferencias](#7-ï¸-conferencias)
- [8. ğŸ”Š Audio, RTP y Codecs](#8--audio-rtp-y-codecs)
- [9. ğŸ§  ASTDB (Base de datos interna)](#9--astdb-base-de-datos-interna)
- [10. ğŸ” Seguridad, AMI y logs](#10--seguridad-ami-y-logs)
- [11. ğŸ› ï¸ Extras y herramientas](#11-ï¸-extras-y-herramientas)
- [12. ğŸ”‘ Cambio de contraseÃ±as](#12--cambio-de-contraseÃ±as)
    - [ğŸ”¹ ExtensiÃ³n PJSIP](#-extensiÃ³n-pjsip)
    - [ğŸ”¹ ExtensiÃ³n SIP clÃ¡sico](#-extensiÃ³n-sip-clÃ¡sico)
    - [ğŸ”¹ Usuario AMI (manager.conf)](#-usuario-ami-managerconf)
    - [ğŸ”¹ Usuario del sistema Linux](#-usuario-del-sistema-linux)
- [13. ğŸ§© Script de diagnÃ³stico rÃ¡pido](#13--script-de-diagnÃ³stico-rÃ¡pido)
- [14. â˜ï¸ Pruebas de llamadas desde CLI](#14-ï¸-pruebas-de-llamadas-desde-cli)

---

# 1. ğŸ§­ NavegaciÃ³n y ayuda CLI

```bash
help                              # Muestra todos los comandos disponibles
!                                 # Ejecuta comandos del sistema desde Asterisk CLI
cli show aliases                  # Muestra alias definidos en CLI
cli show permissions              # Muestra permisos de usuario actual
cli reload permissions            # Recarga configuraciÃ³n de permisos
core show sysinfo                 # InformaciÃ³n del sistema
core show uptime                  # Tiempo de actividad del servicio Asterisk
core show version                 # Muestra versiÃ³n actual de Asterisk
```

---

# 2. ğŸ“ Extensiones PJSIP y SIP

### ğŸ”¹ PJSIP

```bash
pjsip show endpoints              # Lista todas las extensiones PJSIP
pjsip show contacts               # Muestra IP, puerto y estado de registro de extensiones
pjsip show endpoint 1001          # InformaciÃ³n detallada de la extensiÃ³n 1001
pjsip qualify 1001                # Envia un ping SIP (OPTIONS) a la extensiÃ³n
pjsip show aors                   # Muestra Address of Record configurados
pjsip show auths                  # Lista autenticaciones configuradas
pjsip show transports             # Lista transportes SIP definidos (UDP, TCP, TLS)
```

### ğŸ”¹ SIP clÃ¡sico (chan_sip)

```bash
sip show peers                    # Lista extensiones SIP configuradas
sip show peer 1001                # Detalles de conexiÃ³n y autenticaciÃ³n del peer
sip show registry                 # Estado de registros SIP hacia ITSPs o PBX externas
sip qualify peer 1001             # EnvÃ­a ping SIP clÃ¡sico a la extensiÃ³n
sip reload                        # Recarga configuraciÃ³n de chan_sip
```

### ğŸ”¹ IAX2

```bash
iax2 show peers                   # Lista extensiones o troncales IAX2
iax2 show registry                # Estado de registros IAX2
iax2 reload                       # Recarga configuraciÃ³n de IAX2
```

---

# 3. ğŸ“¡ Troncales y registros externos

```bash
sip show registry                 # Registros SIP salientes
iax2 show registry                # Registros IAX salientes
dahdi show channels               # Canales fÃ­sicos DAHDI
pri show spans                    # Estado de interfaces PRI (E1/T1)
```

---

# 4. ğŸ“Š Canales y llamadas

```bash
core show channels                # Llamadas activas con detalles
core show channels concise        # Llamadas activas en formato resumido
core show calls                   # NÃºmero de llamadas y canales activos
core show channel CHANNEL         # InformaciÃ³n detallada de un canal especÃ­fico
core show channelstats            # EstadÃ­sticas detalladas por canal
channel request hangup CHANNEL    # Finaliza una llamada especÃ­fica
```

---

# 5. ğŸ” Recargas, mÃ³dulos y reinicios

```bash
core reload                       # Recarga completa de Asterisk sin reiniciar
dialplan reload                   # Recarga solo el dialplan (plan de marcado)
module show                       # Muestra mÃ³dulos cargados
module reload res_pjsip.so        # Recarga solo el mÃ³dulo PJSIP
core restart now                  # Reinicio inmediato de Asterisk
core stop gracefully              # Detiene Asterisk sin cortar llamadas activas
```

---

# 6. ğŸ“¥ Colas y agentes

```bash
queue show                        # Estado de colas y agentes conectados
queue reload all                  # Recarga configuraciÃ³n de todas las colas
queue pause member PJSIP/1001     # Pausa al agente 1001
agent show all                    # Lista de agentes del sistema
agent logoff                      # Cierra sesiÃ³n del agente actual
```

---

# 7. ğŸ™ï¸ Conferencias

```bash
confbridge list                   # Muestra conferencias activas y participantes
confbridge mute all               # Silencia a todos los participantes
confbridge unmute all             # Reactiva el audio de todos los participantes
confbridge kick <ext>             # Expulsa una extensiÃ³n de la sala
meetme list                       # Lista conferencias activas (modo legacy)
meetme kick <user>                # Expulsa un usuario especÃ­fico de MeetMe
```

---

# 8. ğŸ”Š Audio, RTP y Codecs

```bash
rtp set debug on                  # Muestra trÃ¡fico RTP en consola
rtp set debug off                 # Detiene visualizaciÃ³n RTP
core show codecs audio            # Lista codecs de audio disponibles
core show sounds                  # Lista sonidos instalados en el sistema
file convert archivo.wav archivo.gsm  # Convierte archivos de audio
```

---

# 9. ğŸ§  ASTDB (Base de datos interna)

```bash
database show                     # Lista completa de la base de datos
database put family key value     # Guarda un valor en la base
database get family key           # Consulta un valor
database del family key           # Elimina un valor
```

---

# 10. ğŸ” Seguridad, AMI y logs

```bash
manager show users                # Lista usuarios AMI definidos
manager show connected            # Conexiones AMI activas
pjsip show unidentified_requests  # Solicitudes SIP no identificadas
logger show channels              # Muestra canales de log activos
core set verbose 4                # Nivel de detalle en consola (0 a 10)
```

---

# 11. ğŸ› ï¸ Extras y herramientas

```bash
fax show sessions                 # Sesiones de fax activas
fax show stats                    # EstadÃ­sticas generales de fax
http show status                  # Estado del servidor web embebido
xmldoc dump                       # Exporta documentaciÃ³n XML
dnsmgr status                     # Estado del gestor DNS
say load new                      # Activa el motor de locuciÃ³n nuevo
```

---

# 12. ğŸ”‘ Cambio de contraseÃ±as

### ğŸ”¹ ExtensiÃ³n PJSIP

```ini
[1001]
type=auth
auth_type=userpass
password=NuevaContraseÃ±aFuerte
```

### ğŸ”¹ ExtensiÃ³n SIP clÃ¡sico

```ini
[1001]
secret=NuevaContraseÃ±aSegura
```

### ğŸ”¹ Usuario AMI (manager.conf)

```ini
[admin]
secret=NuevaClaveAMI
read=all
write=all
```

```bash
asterisk -rx "module reload manager"
```

### ğŸ”¹ Usuario del sistema Linux

```bash
passwd root
passwd usuario
```

---

# 13. ğŸ§© Script de diagnÃ³stico rÃ¡pido

```bash
#!/bin/bash
echo "Canales activos:"
asterisk -rx "core show channels"
echo "Contactos registrados:"
asterisk -rx "pjsip show contacts"
echo "Colas activas:"
asterisk -rx "queue show"
echo "Estado del sistema:"
asterisk -rx "core show sysinfo"
```

---

# 14. â˜ï¸ Pruebas de llamadas desde CLI

```bash
channel originate PJSIP/1001 extension@from-internal
```
> Llamada desde Asterisk hacia la extensiÃ³n 1001 usando PJSIP.

```bash
channel originate SIP/1001 extension@from-internal
```
> Llamada usando SIP clÃ¡sico (chan_sip).

```bash
channel originate Local/1002@from-internal extension@from-internal
```
> SimulaciÃ³n de llamada entre extensiones del mismo contexto.

```bash
channel originate PJSIP/troncal/999999999 extension@from-internal
```
> Llamada saliente por troncal (reemplazar nombre y nÃºmero).

```bash
core show channels
```
> Verifica si la llamada estÃ¡ activa.

```bash
channel request hangup CHANNEL-ID
```
> Finaliza una llamada desde consola.
